<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Laberinto del Gatito üê±</title>
<style>
  body {
    margin:0;
    background:#222;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    color:white;
  }
  #gameContainer {
    display: flex;
    gap: 20px;
    align-items: center;
  }
  canvas {
    border:4px solid #333;
    background:white;
    display:block;
  }
  #timer {
    font-size:32px;
    color:red;
    font-weight:bold;
    margin-bottom:15px;
    text-align:center;
  }
  /* Controles t√°ctiles */
  #mobileControls {
    display: grid;
    grid-template-columns: 60px 60px 60px;
    grid-template-rows: 60px 60px 60px;
    grid-gap: 10px;
    justify-content: center;
    margin-top: 20px;
  }
  #mobileControls button {
    background: rgba(50,50,50,0.8);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 28px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    transition: transform 0.1s;
  }
  #mobileControls button:active {
    background: rgba(255,255,255,0.8);
    transform: scale(1.2);
  }
  /* Ubicar flechas */
  #btnUp { grid-column: 2; grid-row: 1; }
  #btnLeft { grid-column: 1; grid-row: 2; }
  #btnRight { grid-column: 3; grid-row: 2; }
  #btnDown { grid-column: 2; grid-row: 3; }
</style>
</head>
<body>
<div id="gameContainer">
  <div>
    <div id="timer">10</div>
    <canvas id="gameCanvas" width="800" height="480"></canvas>
  </div>
  <!-- Controles m√≥viles a la derecha -->
  <div id="mobileControls">
    <button id="btnUp" onclick="movePlayer(0,-1)">‚¨ÜÔ∏è</button>
    <button id="btnLeft" onclick="movePlayer(-1,0)">‚¨ÖÔ∏è</button>
    <button id="btnRight" onclick="movePlayer(1,0)">‚û°Ô∏è</button>
    <button id="btnDown" onclick="movePlayer(0,1)">‚¨áÔ∏è</button>
  </div>
</div>

<!-- Audios -->
<audio id="winSound" src="audio/win.mp3"></audio>
<audio id="loseSound" src="audio/lose.mp3"></audio>
<audio id="meowSound" src="audio/meow.mp3"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const tileSize = 40;
const rows = 12;
const cols = 20;

const maze1 = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1],
  [1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,1,0,1],
  [1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,1],
  [1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,0,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,1],
  [1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,1],
  [1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

const maze2 = JSON.parse(JSON.stringify(maze1));
const maze3 = JSON.parse(JSON.stringify(maze1));

let mazes = [maze1, maze2, maze3];
let currentMazeIndex = 0;
let maze = mazes[currentMazeIndex];

let player = {x:1, y:1};
let fishes = [];

let catImage = new Image();
catImage.src = "images/gato.png";

const winSound = document.getElementById("winSound");
const loseSound = document.getElementById("loseSound");
const meowSound = document.getElementById("meowSound");

let audioEnabled = false;
document.addEventListener("keydown", ()=>{ audioEnabled=true; }, {once:true});
document.addEventListener("click", ()=>{ audioEnabled=true; }, {once:true});

function setMaze(index){
  currentMazeIndex = index;
  maze = mazes[currentMazeIndex];
  player = {x:1, y:1};
  if(currentMazeIndex===0){
    fishes = [{x:17,y:1,collected:false},{x:5,y:9,collected:false}];
  } else if(currentMazeIndex===1){
    fishes = [{x:18,y:1,collected:false},{x:3,y:9,collected:false}];
  } else {
    fishes = [{x:18,y:1,collected:false},{x:1,y:10,collected:false}];
  }
  stopAllSounds();
  drawGame();
  startCountdown();
}

function stopAllSounds(){
  [winSound, loseSound, meowSound].forEach(s=>{
    s.pause();
    s.currentTime=0;
  });
}

function drawMaze(){
  for(let y=0;y<maze.length;y++){
    for(let x=0;x<maze[y].length;x++){
      if(maze[y][x]===1){ctx.fillStyle="#333";}
      else if(maze[y][x]===2){ctx.fillStyle=fishes.every(f=>f.collected)?"lime":"gray";}
      else{ctx.fillStyle="white";}
      ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);
      ctx.strokeStyle="#ddd";
      ctx.strokeRect(x*tileSize, y*tileSize, tileSize, tileSize);
    }
  }
}

function drawPlayer(){
  if(catImage.complete){
    ctx.drawImage(catImage, player.x*tileSize, player.y*tileSize, tileSize, tileSize);
  }
}

function drawFishes(){
  ctx.font = tileSize+"px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  for(let f of fishes){
    if(!f.collected){
      ctx.fillText("üêü", f.x*tileSize + tileSize/2, f.y*tileSize + tileSize/2);
    }
  }
}

function drawGame(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMaze();
  drawFishes();
  drawPlayer();
}

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowUp") movePlayer(0,-1);
  if(e.key==="ArrowDown") movePlayer(0,1);
  if(e.key==="ArrowLeft") movePlayer(-1,0);
  if(e.key==="ArrowRight") movePlayer(1,0);
});

function movePlayer(dx,dy){
  let nx = player.x+dx;
  let ny = player.y+dy;
  if(maze[ny] && maze[ny][nx]!==1){
    player.x=nx; player.y=ny;
    for(let f of fishes){
      if(!f.collected && f.x===player.x && f.y===player.y){
        f.collected=true;
        if(audioEnabled) meowSound.play();
        alert("¬°Agarraste un pescadito! üêü");
      }
    }
    if(maze[ny][nx]===2){
      if(fishes.every(f=>f.collected)){
        if(audioEnabled) winSound.play();
        alert("¬°Ganaste! üéâ");
        resetGame();
      } else {
        alert("Primero busca todos los pescaditos üêüüêü");
      }
    }
  }
  drawGame();
}

let timeLeft = 10;
let timerInterval;
function startCountdown(){
  clearInterval(timerInterval);
  timeLeft=10;
  document.getElementById("timer").textContent = timeLeft;
  timerInterval = setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft;
    if(timeLeft<=0){
      clearInterval(timerInterval);
      stopAllSounds();
      if(audioEnabled) loseSound.play();
      alert("¬°Se acab√≥ el tiempo! üòø");
      resetGame();
    }
  },1000);
}

function resetGame(){
  stopAllSounds();
  currentMazeIndex = (currentMazeIndex+1)%mazes.length;
  setMaze(currentMazeIndex);
}

setMaze(0);
</script>
</body>
</html>
