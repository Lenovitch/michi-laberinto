<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Laberinto del Gatito üê±</title>
<style>
  body { margin:0; background:#222; display:flex; justify-content:center; align-items:center; flex-direction:column; }
  canvas { border:4px solid #333; background:white; display:block; }
  #timer { font-size:32px; color:red; font-weight:bold; margin:10px; }
  #mobileControls button {
    font-size:24px;
    width:60px;
    height:60px;
    margin:5px;
    border-radius:10px;
  }
</style>
</head>
<body>
<div id="timer">10</div>
<canvas id="gameCanvas"></canvas>

<div id="mobileControls">
  <button onclick="movePlayer(0,-1)">‚¨ÜÔ∏è</button><br>
  <button onclick="movePlayer(-1,0)">‚¨ÖÔ∏è</button>
  <button onclick="movePlayer(1,0)">‚û°Ô∏è</button><br>
  <button onclick="movePlayer(0,1)">‚¨áÔ∏è</button>
</div>

<!-- Audios -->
<audio id="winSound" src="audio/win.mp3"></audio>
<audio id="loseSound" src="audio/lose.mp3"></audio>
<audio id="meowSound" src="audio/meow.mp3"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const tileSize = 40;
const rows = 12;
const cols = 20;

// Laberintos (ejemplo 3)
const maze1 = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1],
  [1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,1,0,1],
  [1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,1],
  [1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,0,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,1],
  [1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,1],
  [1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

const maze2 = JSON.parse(JSON.stringify(maze1)); // otro laberinto igual de dif√≠cil
const maze3 = JSON.parse(JSON.stringify(maze1)); // tercer laberinto

let mazes = [maze1, maze2, maze3];
let currentMazeIndex = 0;
let maze = mazes[currentMazeIndex];

let player = {x:1, y:1};
let fishes = [];

// Gatito
let catImage = new Image();
catImage.src = "images/gato.png";

// Audios
const winSound = document.getElementById("winSound");
const loseSound = document.getElementById("loseSound");
const meowSound = document.getElementById("meowSound");

// Habilitar audio tras interacci√≥n
let audioEnabled = false;
document.addEventListener("keydown", ()=>{ audioEnabled=true; }, {once:true});
document.addEventListener("click", ()=>{ audioEnabled=true; }, {once:true});

// Ajustar canvas
function adjustCanvas(){
  canvas.width = Math.min(window.innerWidth-20, cols*tileSize);
  canvas.height = Math.min(window.innerHeight-150, rows*tileSize);
  drawGame();
}
window.addEventListener("resize", adjustCanvas);

// Inicializaci√≥n
function setMaze(index){
  currentMazeIndex = index;
  maze = mazes[currentMazeIndex];
  player = {x:1, y:1};
  if(currentMazeIndex===0){
    fishes = [{x:17,y:1,collected:false},{x:5,y:9,collected:false}];
  } else if(currentMazeIndex===1){
    fishes = [{x:18,y:1,collected:false},{x:3,y:9,collected:false}];
  } else {
    fishes = [{x:18,y:1,collected:false},{x:1,y:10,collected:false}];
  }
  stopAllSounds();
  adjustCanvas();
  startCountdown();
}

function stopAllSounds(){
  [winSound, loseSound, meowSound].forEach(s=>{
    s.pause();
    s.currentTime=0;
  });
}

// Dibujos
function drawMaze(){
  for(let y=0;y<maze.length;y++){
    for(let x=0;x<maze[y].length;x++){
      if(maze[y][x]===1){ctx.fillStyle="#333";}
      else if(maze[y][x]===2){ctx.fillStyle=fishes.every(f=>f.collected)?"lime":"gray";}
      else{ctx.fillStyle="white";}
      ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);
      ctx.strokeStyle="#ddd";
      ctx.strokeRect(x*tileSize, y*tileSize, tileSize, tileSize);
    }
  }
}

function drawPlayer(){
  if(catImage.complete){
    const scaleX = canvas.width/(cols*tileSize);
    const scaleY = canvas.height/(rows*tileSize);
    ctx.drawImage(catImage, player.x*tileSize*scaleX, player.y*tileSize*scaleY, tileSize*scaleX, tileSize*scaleY);
  }
}

function drawFishes(){
  const scale = Math.min(canvas.width/(cols*tileSize), canvas.height/(rows*tileSize));
  ctx.font = tileSize*scale+"px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  for(let f of fishes){
    if(!f.collected){
      const scaleX = canvas.width/(cols*tileSize);
      const scaleY = canvas.height/(rows*tileSize);
      ctx.fillText("üêü", f.x*tileSize*scaleX + tileSize*scaleX/2, f.y*tileSize*scaleY + tileSize*scaleY/2);
    }
  }
}

function drawGame(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMaze();
  drawFishes();
  drawPlayer();
}

// Movimiento
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowUp") movePlayer(0,-1);
  if(e.key==="ArrowDown") movePlayer(0,1);
  if(e.key==="ArrowLeft") movePlayer(-1,0);
  if(e.key==="ArrowRight") movePlayer(1,0);
});

function movePlayer(dx,dy){
  let nx = player.x+dx;
  let ny = player.y+dy;
  if(maze[ny] && maze[ny][nx]!==1){
    player.x=nx; player.y=ny;
    for(let f of fishes){
      if(!f.collected && f.x===player.x && f.y===player.y){
        f.collected=true;
        if(audioEnabled) meowSound.play();
        alert("¬°Agarraste un pescadito! üêü");
      }
    }
    if(maze[ny][nx]===2){
      if(fishes.every(f=>f.collected)){
        if(audioEnabled) winSound.play();
        alert("¬°Ganaste! üéâ");
        resetGame();
      } else {
        alert("Primero busca todos los pescaditos üêüüêü");
      }
    }
  }
  drawGame();
}

// Timer
let timeLeft = 10;
let timerInterval;
function startCountdown(){
  clearInterval(timerInterval);
  timeLeft=10;
  document.getElementById("timer").textContent = timeLeft;
  timerInterval = setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft;
    if(timeLeft<=0){
      clearInterval(timerInterval);
      stopAllSounds();
      if(audioEnabled) loseSound.play();
      alert("¬°Se acab√≥ el tiempo! üòø");
      resetGame();
    }
  },1000);
}

function resetGame(){
  stopAllSounds();
  currentMazeIndex = (currentMazeIndex+1)%mazes.length;
  setMaze(currentMazeIndex);
}

// Iniciar juego
setMaze(0);

</script>
</body>
</html>
