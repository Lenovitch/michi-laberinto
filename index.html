<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Laberinto del Gatito üê±</title>
<style>
  body { margin:0; background:#222; display:flex; justify-content:center; align-items:center; height:100vh; }
  canvas { border:4px solid #333; background:white; }
  #timer { position:absolute; top:10px; left:50%; transform:translateX(-50%); font-size:32px; color:red; font-weight:bold; }
</style>
</head>
<body>
<div id="timer">10</div>

<!-- Audios desde la carpeta audio -->
<audio id="winSound" src="audio/win.mp3"></audio>
<audio id="loseSound" src="audio/lose.mp3"></audio>
<audio id="meowSound" src="audio/meow.mp3"></audio>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const tileSize = 40;
const rows = 12;
const cols = 20;
canvas.width = cols * tileSize;
canvas.height = rows * tileSize;

// Laberintos
const maze1 = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1],
  [1,0,1,0,1,0,1,1,1,0,1,0,1,1,1,0,1,1,0,1],
  [1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,1],
  [1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,0,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,1],
  [1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,1],
  [1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

const maze2 = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1],
  [1,0,1,1,1,1,0,1,1,0,1,1,1,0,1,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
  [1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,0,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,1],
  [1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,1],
  [1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

const maze3 = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,1,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,0,1],
  [1,0,1,1,1,0,1,0,1,1,0,1,0,1,1,0,1,1,0,1],
  [1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,1],
  [1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,1,0,1,1,0,1,1,1,1,0,1,1,1,0,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,1],
  [1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,1],
  [1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

let mazes = [maze1, maze2, maze3];
let currentMazeIndex = 0;
let maze = mazes[currentMazeIndex];

let player = {x:1, y:1};
let fishes = [];

// Gatito desde la carpeta images
let catImage = new Image();
catImage.src = "images/gato.png";
catImage.onload = () => { drawGame(); }

// Audios
const winSound = document.getElementById("winSound");
const loseSound = document.getElementById("loseSound");
const meowSound = document.getElementById("meowSound");

// Habilitar audio tras interacci√≥n del usuario
let audioEnabled = false;
document.addEventListener("keydown", ()=>{ audioEnabled = true; }, { once: true });
document.addEventListener("click", ()=>{ audioEnabled = true; }, { once: true });

// Funciones
function setMaze(index){
  currentMazeIndex = index;
  maze = mazes[currentMazeIndex];
  player = {x:1,y:1};
  if(currentMazeIndex===0){
    fishes = [{x:17,y:1, collected:false},{x:5,y:9,collected:false}];
  } else if(currentMazeIndex===1){
    fishes = [{x:18,y:1,collected:false},{x:3,y:9,collected:false}];
  } else {
    fishes = [{x:18,y:2,collected:false},{x:1,y:10,collected:false}];
  }
  stopAllSounds();
  drawGame();
  startCountdown();
}

function stopAllSounds(){
  [winSound, loseSound, meowSound].forEach(sound=>{
    sound.pause();
    sound.currentTime = 0;
  });
}

function drawMaze(){
  for(let y=0;y<maze.length;y++){
    for(let x=0;x<maze[y].length;x++){
      if(maze[y][x]===1){ctx.fillStyle="#333";}
      else if(maze[y][x]===2){ctx.fillStyle=fishes.every(f=>f.collected)?"lime":"gray";}
      else{ctx.fillStyle="white";}
      ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);
      ctx.strokeStyle="#ddd";
      ctx.strokeRect(x*tileSize,y*tileSize,tileSize,tileSize);
    }
  }
}

function drawPlayer(){
  if(catImage.complete){
    ctx.drawImage(catImage, player.x*tileSize, player.y*tileSize, tileSize, tileSize);
  }
}

function drawFishes(){
  ctx.font = tileSize+"px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  for(let f of fishes){
    if(!f.collected){
      ctx.fillText("üêü", f.x*tileSize + tileSize/2, f.y*tileSize + tileSize/2);
    }
  }
}

function drawGame(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMaze();
  drawFishes();
  drawPlayer();
}

document.addEventListener("keydown", e=>{
  let dx=0, dy=0;
  if(e.key==="ArrowUp") dy=-1;
  if(e.key==="ArrowDown") dy=1;
  if(e.key==="ArrowLeft") dx=-1;
  if(e.key==="ArrowRight") dx=1;
  movePlayer(dx,dy);
});

function movePlayer(dx, dy){
  let nx = player.x + dx;
  let ny = player.y + dy;
  if(maze[ny] && maze[ny][nx] !== 1){
    player.x = nx;
    player.y = ny;

    for(let f of fishes){
      if(!f.collected && f.x===player.x && f.y===player.y){
        f.collected = true;
        if(audioEnabled) meowSound.play();
        alert("¬°Agarraste un pescadito! üêü");
      }
    }

    if(maze[ny][nx] === 2){
      if(fishes.every(f=>f.collected)){
        if(audioEnabled) winSound.play();
        alert("¬°Ganaste! üéâ");
        resetGame();
      } else {
        alert("Primero busca todos los pescaditos üêüüêü");
      }
    }
  }
  drawGame();
}

// Timer
let timeLeft = 10;
let timerInterval;
function startCountdown(){
  clearInterval(timerInterval);
  timeLeft = 10;
  document.getElementById("timer").textContent = timeLeft;
  timerInterval = setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft;
    if(timeLeft <= 0){
      clearInterval(timerInterval);
      stopAllSounds();
      if(audioEnabled) loseSound.play();
      alert("¬°Se acab√≥ el tiempo! üòø");
      resetGame();
    }
  }, 1000);
}

function resetGame(){
  stopAllSounds();
  currentMazeIndex = (currentMazeIndex + 1) % mazes.length;
  setMaze(currentMazeIndex);
}

// Iniciar primer laberinto
setMaze(0);
</script>
</body>
</html>
